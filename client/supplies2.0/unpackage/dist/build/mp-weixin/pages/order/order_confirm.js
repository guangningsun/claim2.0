(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order_confirm"],{"339f":function(e,t,i){"use strict";i.r(t);var a=i("6bf0"),s=i.n(a);for(var o in a)"default"!==o&&function(e){i.d(t,e,(function(){return a[e]}))}(o);t["default"]=s.a},"6bf0":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{apartment_balance:"",apartment_name:"",apartment_id:"",imgList:[],switchIsSpeciall:!0,order_item_list:[],exceed_reason:"",tel:e.getStorageSync(getApp().globalData.key_phone_num),apart_name:"",name:e.getStorageSync(getApp().globalData.key_user_name),totalPrice:0,balance:this.apartment_balance-this.totalPrice,exceed_hint:"无",is_exceed:!1,is_item_price_exceed:!1,imgFileList:[],imageFile:null}},onLoad:function(){this.order_item_list=getApp().globalData.cart_list_info;var e=this.order_item_list.filter((function(e){return e.number>0}));this.order_item_list=e,console.log(this.order_item_list);for(var t=0,i=0;i<this.order_item_list.length;i++)console.log(this.order_item_list[i]),t+=this.order_item_list[i].total_price;this.totalPrice=t,this.requestBalance();var a=this.order_item_list.filter((function(e){return e.is_exceed}));a.length>0&&(this.is_exceed=!0,this.exceedHint+="单价超限。",this.is_item_price_exceed=!0)},onHide:function(){},onShow:function(){},methods:{successCb:function(e){if(0===e.data.error){console.log(e.data);var t=e.data.msg.budget_info[0];this.apartment_balance=t.surplus,this.apart_name=t.category_name,this.apart_id=t.category,this.balance=this.apartment_balance-this.totalPrice,this.totalPrice>this.apartment_balance&&(this.is_exceed=!0,this.exceedHint="总价超过部门余额。")}},failCb:function(e){console.log("get_apartment_balance failed",e)},completeCb:function(e){},requestBalance:function(){this.requestWithMethod(getApp().globalData.get_apartment_balance+e.getStorageSync(getApp().globalData.key_cat),"GET","",this.successCb,this.failCb,this.completeCb)},ViewImage:function(t){e.previewImage({urls:this.imgList,current:t.currentTarget.dataset.url})},DelImg:function(t){var i=this;e.showModal({title:"删除照片",content:"确定要删除这张照片吗？",cancelText:"否",confirmText:"是",success:function(e){e.confirm&&i.imgList.splice(t.currentTarget.dataset.index,1)}})},ChooseImage:function(){var t=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log(e),0!=t.imgList.length?(t.imgList=t.imgList.concat(e.tempFilePaths),t.imgFileList=t.imgFileList.concat(e.tempFiles)):(t.imgList=e.tempFilePaths,t.imgFileList=e.tempFiles),console.log(t.imgFileList)}})},SwitchIsSpeciall:function(e){this.switchIsSpeciall=e.detail.value},successCallback:function(t){console.log(t),0===t.data.error&&(e.showToast({title:"提交成功",success:function(){e.navigateTo({url:"./order_list"})}}),getApp().globalData.cart_list_info=[])},failCallback:function(t){e.hideLoading(),console.log("api_device_opt failed",t)},completeCallback:function(e){},submit:function(){var t=this;if(void 0!=this.switchIsSpeciall){var i=getApp().globalData.cart_list_info;if(console.log(i),!this.is_item_price_exceed||!this.isEmpty(this.exceed_reason)&&0!=this.imgList.length)if(this.totalPrice>this.apartment_balance&&(this.isEmpty(this.exceed_reason)||0==this.imgList.length))this.showToast("总价超过部门余额，请填写超限原因及拍照");else if(!this.switchIsSpeciall||!this.isEmpty(this.exceed_reason)&&0!=this.imgList.length){e.showLoading({title:"正在提交订单"});var a=[],s=i.map((function(e){return Object.assign({item_sn:e.asset_sn},{item_supplier_id:e.selected_supplier},{item_num:e.number},{item_price:e.total_price})}));a=s;var o={weixin_openid:e.getStorageSync(getApp().globalData.key_wx_openid),order_apartment:this.apart_id,order_exceed_reason:this.exceed_reason,order_is_special:this.switchIsSpeciall?"True":"False",order_item_list:JSON.stringify(a),order_total_price:this.totalPrice,is_exceed:this.is_exceed?"True":"False"},n=getApp().globalData.domain_port+getApp().globalData.get_submit_order;if(this.imgList.length>0)console.log(this.imgList),e.uploadFile({url:n,filePath:this.imgList[0],name:"order_image",formData:o,header:{"content-type":"multipart/form-data"},success:function(i){t.successCallback(i),console.log("upload success"),console.log(i.statusCode);var a=JSON.parse(i.data);200==i.statusCode&&0==a.error&&(e.showToast({title:"提交成功",success:function(){e.navigateTo({url:"./order_list"})}}),getApp().globalData.cart_list_info=[])},fail:function(i){console.log(i),console.log("upload failed"),e.hideLoading(),t.showToast("提交失败")}});else{var l={weixin_openid:e.getStorageSync(getApp().globalData.key_wx_openid),order_apartment:this.apart_id,order_exceed_reason:this.exceed_reason,order_is_special:this.switchIsSpeciall?"True":"False",order_image:"",order_item_list:JSON.stringify(a),order_total_price:this.totalPrice,is_exceed:this.is_exceed?"True":"False"};this.requestWithMethod(getApp().globalData.get_submit_order,"POST",l,this.successCallback,this.failCallback,this.completeCallback)}}else this.showToast("专项申请，请填写超限原因及拍照");else this.showToast("单价超限，请填写超限原因及拍照")}else this.showToast("确定是否为专项申请？")}}};t.default=i}).call(this,i("543d")["default"])},a3b1:function(e,t,i){"use strict";i.r(t);var a=i("caf4"),s=i("339f");for(var o in s)"default"!==o&&function(e){i.d(t,e,(function(){return s[e]}))}(o);i("cbcb");var n,l=i("f0c5"),r=Object(l["a"])(s["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],n);t["default"]=r.exports},caf4:function(e,t,i){"use strict";var a,s=function(){var e=this,t=e.$createElement;e._self._c},o=[];i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return a}))},cbcb:function(e,t,i){"use strict";var a=i("ee0e"),s=i.n(a);s.a},e986:function(e,t,i){"use strict";(function(e){i("80e3");a(i("66fd"));var t=a(i("a3b1"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("543d")["createPage"])},ee0e:function(e,t,i){}},[["e986","common/runtime","common/vendor"]]]);